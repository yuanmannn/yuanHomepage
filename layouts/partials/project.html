{{ $contextType := printf "%T" . }}
{{ $isShortcode := (eq $contextType "*hugolib.ShortcodeWithPage") }}

{{/*
  sectionId: Optional argument to override the default HTML id for this section. If not provided, the default id is used.
  hideViewAll: Optional argument to hide the "View All" button. Set to "true" to hide the button. */}}
{{ $sectionId := "project-single" }}
{{ $showViewAll := false }} {{/* 默认设置为false，不显示按钮 */}}
{{ if $isShortcode }}
  {{ with .Get "sectionId" }}
    {{ $sectionId = . }}
  {{ end }}
  {{ $hideViewAllParam := .Get "hideViewAll" }}
  {{ if eq $hideViewAllParam "true" }}
    {{ $showViewAll = false }}
  {{ end }}
{{ end }}

<section {{if $sectionId}} id="{{ $sectionId }}"{{end}} class="section-project section section--border-bottom rad-animation-group flex-grow-1">
  <div class="row flex-column-reverse flex-md-row rad-fade-down">
    <div class="project-list col-12 col-md-3">
      <h2>
        {{ if $isShortcode }}
          {{ .Get "title" | default "" }}
        {{ else }}
          {{ i18n "project_title" }}
        {{ end }}
      </h2>

      {{ $xp := where .Site.RegularPages.ByDate "Type" "project" }}
      {{ if not $isShortcode }}
        {{ $baseLangSite := .Sites.Default }}
        {{ $xp = $xp | lang.Merge (where $baseLangSite.RegularPages.ByDate.Reverse "Type" "project") }}
      {{ end }}

      {{ $xpCount := len $xp }}
{{/* in the homepage we limit to the homepageProjectCount param (6 by default) in the inner page (project) we display the all */}}
      {{ $totalCount := .Site.Params.homepageProjectCount }}

      {{ if not $isShortcode }}
      {{ if not .IsHome }}
        {{ $totalCount = $xpCount }}
      {{ end }}
      {{ end }}

      {{ range first $totalCount (sort $xp "Date" "desc") }}
      <div class="project">
        <a href="{{ .Permalink | relURL }}" class="project__link">
          <div class="project__header">
            {{ $img := resources.Get .Params.companyLogo }}
            {{ with $img }}
              {{ $imgWebp := $img.Resize (printf "%dx%d webp q75 Lanczos picture" $img.Width $img.Height) }}
              <img 
                src="{{ $imgWebp.RelPermalink }}" 
                alt="{{ .Params.company }} logo"
                class="project__company-logo"
                loading="lazy"
              />
            {{ end }}
          <div class="project__meta">
              <div class="project__title">{{ .Params.projectTitle }}</div>
              <div class="project__company">{{ .Params.duration }}</div>
          </div>
            <div class="project__description d-none d-print-block">
              <h1>{{ .Params.title }}</h1>
              {{ .Content | safeHTML | transform.Plainify }}
            </div>
          </div>
        </a>
      </div>
      {{ end }}

      {{/* 移除了View All按钮代码 */}}
    </div>
    <div class="project-description col-12 col-md-6">
      {{ partial "project-description.html" . }}
    </div>
  </div>
</section>